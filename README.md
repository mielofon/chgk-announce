# Зачем это

Вы привыкли часто лазить на сайт рейтинга, чтобы посмотреть, не занесли ли в базу недавно сыгранный турнир? Этот скрипт делает работу за вас: определяет новые турниры команды, подсчитывает итоги выступления и высылает письмо на электронную почту.

# Пример письма

>Дружелюбный робот приветствует вас. Новый турнир занесен в рейтинг!

>Интеллектуальная ворона (26.04.15), место 10.  
>Серый рейтинг: 2289. Турнир СКОРЕЕ ВСЕГО ПОШЕЛ в зачет.  
>Желтый рейтинг: предсказанное место 11, занятое место 10, изменение в рейтинге 30.

>===== Немного статистики (только по ТОП 10 турнира) =====

>Победитель: Ксеп с суммой 30  
>Команда Павла Ершова заняла 10 место с суммой 25

>Тур номер 1. В среднем взято 6.6 Взято КПЕ: 8  
>Взяла КПЕ и не взял лидер: 6 7 10  
>Взял лидер и не взяла КПЕ: 9 11  
>Всего гробов в туре: 1. Конкретно: 5

>Тур номер 2. В среднем взято 6.6 Взято КПЕ: 6  
>Взяла КПЕ и не взял лидер: 16  
>Взял лидер и не взяла КПЕ: 14 22  
>Всего гробов в туре: 1. Конкретно: 15

>Тур номер 3. В среднем взято 7.4 Взято КПЕ: 5  
>Взяла КПЕ и не взял лидер:  
>Взял лидер и не взяла КПЕ: 25 27 34 36

>Тур номер 4. В среднем взято 6.5 Взято КПЕ: 6  
>Взяла КПЕ и не взял лидер: 39 42 46  
>Взял лидер и не взяла КПЕ: 37 38 41 48

>Серый рейтинг. Текущее место КПЕ: 16, прогноз: 10, дельта: +6. Перегретая команда!  
>Желтый рейтинг. Текущее место КПЕ: 28, прогноз: 28, дельта: 0. Украли победу!
>
>-- See you later, alligator

# Установка и запуск

Скопируйте скрипт себе

```
$ git clone https://github.com/mielofon/chgk-announce
```

* Создайте таблицу в базе данных по приложенному шаблону
* Создайте конфиг из дистрибутива

```
$ cp config.php.dist config.php
```

* Внесите в конфиг данные своей команды
* Запускайте по крону

```
php /(ваш путь)/announce.php
```

# Зависимости
```
php5-curl
php5-tidy
```

# Особенности работы

Пока хранители рейтинга уже несколько лет кормят обещаниями сделать нормальную выгрузку данных, приходится парсить их сайт. Как следствие, скрипт ломается, когда на сайте меняется верстка.

Если письмо не приходит, убедитесь что адрес отправителя, указанный вами в конфиге, на самом деле существует. Если вы отсылаете письмо на лист рассылки, подпишите адрес отправителя на этот лист.
